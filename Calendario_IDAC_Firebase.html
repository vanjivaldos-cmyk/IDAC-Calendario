<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calend√°rio IDAC 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 2.2rem;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 5px;
        }
        .header h2 {
            font-size: 1.1rem;
            color: #a0a0a0;
            font-weight: normal;
        }
        .sync-status {
            text-align: center;
            margin-bottom: 10px;
            font-size: 0.8rem;
        }
        .sync-status.online { color: #22c55e; }
        .sync-status.offline { color: #ef4444; }
        .toolbar {
            max-width: 1600px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .toolbar button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn-add {
            background: #22c55e;
            color: white;
        }
        .btn-add:hover {
            background: #16a34a;
        }
        .btn-export {
            background: #3b82f6;
            color: white;
        }
        .btn-export:hover {
            background: #2563eb;
        }
        .btn-clear {
            background: #ef4444;
            color: white;
        }
        .btn-clear:hover {
            background: #dc2626;
        }
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .month-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .month-header {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,215,0,0.3);
        }
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 5px;
        }
        .weekdays span {
            padding: 5px 0;
        }
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 3px;
            border-radius: 8px;
            font-size: 0.85rem;
            position: relative;
            min-height: 45px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .day:not(.empty):hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.05);
        }
        .day.empty {
            background: transparent;
            cursor: default;
        }
        .day.sunday {
            color: #ff6b6b;
        }
        .day.has-event {
            background: rgba(255,215,0,0.15);
            border: 1px solid rgba(255,215,0,0.3);
        }
        .day.has-event:hover {
            background: rgba(255,215,0,0.25);
        }
        .day .day-number {
            font-weight: bold;
            margin-bottom: 2px;
        }
        .day .event-dots {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .event-dot.lideranca { background: #ff6b6b; }
        .event-dot.tarde-deus { background: #4ecdc4; }
        .event-dot.curso { background: #a855f7; }
        .event-dot.candeias { background: #f97316; }
        .event-dot.mulheres { background: #ec4899; }
        .event-dot.especial { background: #ffd700; }
        .event-dot.ebf { background: #22c55e; }
        .event-dot.homens { background: #3b82f6; }
        .event-dot.outro { background: #6b7280; }
        .event-dot.feriado { background: #dc2626; }
        .event-dot.copa { background: #15803d; }
        .event-dot.eleicao { background: #7c3aed; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid #ffd700;
        }
        .modal h3 {
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 0.95rem;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
        }
        .form-group select option {
            background: #1a1a2e;
            color: #fff;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn-save {
            background: #22c55e;
            color: white;
        }
        .btn-save:hover {
            background: #16a34a;
        }
        .btn-cancel {
            background: #6b7280;
            color: white;
        }
        .btn-cancel:hover {
            background: #4b5563;
        }
        .btn-delete {
            background: #ef4444;
            color: white;
        }
        .btn-delete:hover {
            background: #dc2626;
        }

        /* Lista de eventos no modal */
        .events-in-day {
            margin-bottom: 20px;
        }
        .event-card {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700;
        }
        .event-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .event-card-title {
            color: #ffd700;
            font-weight: bold;
        }
        .event-card-actions {
            display: flex;
            gap: 5px;
        }
        .event-card-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.75rem;
        }
        .btn-edit-small {
            background: #3b82f6;
            color: white;
        }
        .btn-delete-small {
            background: #ef4444;
            color: white;
        }
        .event-card-details {
            font-size: 0.85rem;
            color: #a0a0a0;
        }

        .legend {
            max-width: 1600px;
            margin: 30px auto 0;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .legend h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .events-list {
            max-width: 1600px;
            margin: 30px auto 0;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .events-list h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* Filtros com Checkboxes */
        .filters-container {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .filters-header h4 {
            color: #ffd700;
            font-size: 1rem;
        }
        .filter-section {
            margin-bottom: 15px;
        }
        .filter-section-title {
            color: #4ecdc4;
            font-size: 0.85rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
        }
        .filter-checkbox:hover {
            background: rgba(255,255,255,0.2);
        }
        .filter-checkbox input {
            cursor: pointer;
        }
        .filter-checkbox.checked {
            background: rgba(255,215,0,0.3);
            border: 1px solid #ffd700;
        }
        
        .events-table {
            width: 100%;
            border-collapse: collapse;
        }
        .events-table th,
        .events-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .events-table th {
            color: #ffd700;
            font-weight: bold;
        }
        .events-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        .events-table .actions button {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #22c55e;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            display: none;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }
        .toast.error {
            background: #ef4444;
        }
        .toast.active {
            display: block;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .instructions {
            max-width: 1600px;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: #a0a0a0;
        }
        .instructions strong {
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÖ Calend√°rio IDAC 2026</h1>
        <h2>Igreja de Deus √Åguas Claras - Programa√ß√£o Anual</h2>
    </div>

    <div class="sync-status" id="syncStatus">üîÑ Conectando...</div>

    <div class="instructions">
        <strong>üí° Dica:</strong> Clique em qualquer dia para adicionar ou editar eventos. Os dados s√£o salvos na nuvem automaticamente!
    </div>

    <div class="toolbar">
        <button class="btn-add admin-only" onclick="openAddModal()" style="display:none">‚ûï Novo Evento</button>
        <button class="btn-export" onclick="exportEvents()">üì§ Exportar JSON</button>
        <button class="btn-clear admin-only" onclick="clearAllEvents()" style="display:none">üóëÔ∏è Limpar Tudo</button>
        <button id="adminBtn" onclick="logoutAdmin()" style="padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: bold; background: #6b7280; color: white;">üîê Admin</button>
    </div>

    <div class="calendar-container" id="calendar"></div>

    <div class="legend">
        <h3>Legenda</h3>
        <div class="legend-items">
            <div class="legend-item"><div class="legend-dot" style="background:#ff6b6b"></div>Reuni√£o Lideran√ßa</div>
            <div class="legend-item"><div class="legend-dot" style="background:#4ecdc4"></div>"Noite" com Deus</div>
            <div class="legend-item"><div class="legend-dot" style="background:#a855f7"></div>Curso</div>
            <div class="legend-item"><div class="legend-dot" style="background:#f97316"></div>Culto Candeias</div>
            <div class="legend-item"><div class="legend-dot" style="background:#ec4899"></div>Min. Mulheres</div>
            <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Min. Homens</div>
            <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div>EBF</div>
            <div class="legend-item"><div class="legend-dot" style="background:#ffd700"></div>Eventos Especiais</div>
            <div class="legend-item"><div class="legend-dot" style="background:#6b7280"></div>Outros</div>
            <div class="legend-item"><div class="legend-dot" style="background:#dc2626"></div>Feriado Nacional</div>
            <div class="legend-item"><div class="legend-dot" style="background:#15803d"></div>Copa do Mundo</div>
            <div class="legend-item"><div class="legend-dot" style="background:#7c3aed"></div>Elei√ß√µes</div>
        </div>
    </div>

    <div class="events-list">
        <h3>üìã Lista Completa de Eventos</h3>
        <div class="filters-container">
            <div class="filters-header">
                <h4>üîç Filtros</h4>
                <button onclick="clearFilters()" style="padding: 5px 15px; border: none; border-radius: 5px; background: #6b7280; color: white; cursor: pointer; font-size: 0.8rem;">üîÑ Limpar Filtros</button>
            </div>
            
            <div class="filter-section">
                <div class="filter-section-title">üìÖ M√™s</div>
                <div class="filter-options" id="filterMonths"></div>
            </div>
            
            <div class="filter-section">
                <div class="filter-section-title">üéØ Tipo de Evento</div>
                <div class="filter-options" id="filterTypes"></div>
            </div>
            
            <div class="filter-section">
                <div class="filter-section-title">üë§ Respons√°vel</div>
                <div class="filter-options" id="filterResps"></div>
            </div>
        </div>
        <div id="eventsTableContainer"></div>
    </div>

    <!-- Modal para dia -->
    <div class="modal-overlay" id="dayModal">
        <div class="modal">
            <h3 id="modalTitle">Eventos do Dia</h3>
            <div class="events-in-day" id="eventsInDay"></div>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 0;">
            <h4 style="color: #4ecdc4; margin-bottom: 15px;">Adicionar Novo Evento</h4>
            <div class="form-group">
                <label>T√≠tulo do Evento *</label>
                <input type="text" id="eventTitle" placeholder="Ex: Culto das Mulheres">
            </div>
            <div class="form-group">
                <label>Hor√°rio</label>
                <input type="text" id="eventTime" placeholder="Ex: 20h ou 8h √†s 18h">
            </div>
            <div class="form-group">
                <label>Respons√°vel</label>
                <input type="text" id="eventResp" placeholder="Ex: Pr¬™ Maria Pereira">
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select id="eventType">
                    <option value="especial">Evento Especial</option>
                    <option value="lideranca">Reuni√£o Lideran√ßa</option>
                    <option value="tarde-deus">"Noite" com Deus</option>
                    <option value="curso">Curso</option>
                    <option value="candeias">Culto Candeias</option>
                    <option value="mulheres">Min. Mulheres</option>
                    <option value="homens">Min. Homens</option>
                    <option value="ebf">EBF</option>
                    <option value="feriado">Feriado Nacional</option>
                    <option value="copa">Copa do Mundo</option>
                    <option value="eleicao">Elei√ß√µes</option>
                    <option value="outro">Outro</option>
                </select>
            </div>
            <div class="form-group">
                <label>Observa√ß√µes</label>
                <textarea id="eventNotes" rows="2" placeholder="Observa√ß√µes adicionais..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
                <button class="btn-save" onclick="saveEvent()">Salvar Evento</button>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar evento com sele√ß√£o de data -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h3>Adicionar Novo Evento</h3>
            <div class="form-group">
                <label>Data *</label>
                <input type="date" id="newEventDate" min="2026-01-01" max="2026-12-31">
            </div>
            <div class="form-group">
                <label>T√≠tulo do Evento *</label>
                <input type="text" id="newEventTitle" placeholder="Ex: Culto das Mulheres">
            </div>
            <div class="form-group">
                <label>Hor√°rio</label>
                <input type="text" id="newEventTime" placeholder="Ex: 20h ou 8h √†s 18h">
            </div>
            <div class="form-group">
                <label>Respons√°vel</label>
                <input type="text" id="newEventResp" placeholder="Ex: Pr¬™ Maria Pereira">
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select id="newEventType">
                    <option value="especial">Evento Especial</option>
                    <option value="lideranca">Reuni√£o Lideran√ßa</option>
                    <option value="tarde-deus">"Noite" com Deus</option>
                    <option value="curso">Curso</option>
                    <option value="candeias">Culto Candeias</option>
                    <option value="mulheres">Min. Mulheres</option>
                    <option value="homens">Min. Homens</option>
                    <option value="ebf">EBF</option>
                    <option value="feriado">Feriado Nacional</option>
                    <option value="copa">Copa do Mundo</option>
                    <option value="eleicao">Elei√ß√µes</option>
                    <option value="outro">Outro</option>
                </select>
            </div>
            <div class="form-group">
                <label>Observa√ß√µes</label>
                <textarea id="newEventNotes" rows="2" placeholder="Observa√ß√µes adicionais..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeAddModal()">Cancelar</button>
                <button class="btn-save" onclick="saveNewEvent()">Salvar Evento</button>
            </div>
        </div>
    </div>

    <!-- Modal para editar evento -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <h3>Editar Evento</h3>
            <div class="form-group">
                <label>Data *</label>
                <input type="date" id="editEventDate" min="2026-01-01" max="2026-12-31">
            </div>
            <div class="form-group">
                <label>T√≠tulo do Evento *</label>
                <input type="text" id="editEventTitle">
            </div>
            <div class="form-group">
                <label>Hor√°rio</label>
                <input type="text" id="editEventTime">
            </div>
            <div class="form-group">
                <label>Respons√°vel</label>
                <input type="text" id="editEventResp">
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select id="editEventType">
                    <option value="especial">Evento Especial</option>
                    <option value="lideranca">Reuni√£o Lideran√ßa</option>
                    <option value="tarde-deus">"Noite" com Deus</option>
                    <option value="curso">Curso</option>
                    <option value="candeias">Culto Candeias</option>
                    <option value="mulheres">Min. Mulheres</option>
                    <option value="homens">Min. Homens</option>
                    <option value="ebf">EBF</option>
                    <option value="feriado">Feriado Nacional</option>
                    <option value="copa">Copa do Mundo</option>
                    <option value="eleicao">Elei√ß√µes</option>
                    <option value="outro">Outro</option>
                </select>
            </div>
            <div class="form-group">
                <label>Observa√ß√µes</label>
                <textarea id="editEventNotes" rows="2"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn-delete" onclick="deleteEditingEvent()">Excluir</button>
                <button class="btn-cancel" onclick="closeEditModal()">Cancelar</button>
                <button class="btn-save" onclick="updateEvent()">Salvar</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== CONFIGURA√á√ÉO ADMIN ====================
        const SENHA_ADMIN = 'idac2026';
        let isAdmin = false;

        function checkAdmin() {
            const senha = prompt('Digite a senha de administrador:');
            if (senha === SENHA_ADMIN) {
                isAdmin = true;
                document.getElementById('adminBtn').innerHTML = 'üîì Admin (Logado)';
                document.getElementById('adminBtn').style.background = '#22c55e';
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = '');
                showToast('Acesso de administrador liberado!');
                updateEventsTable();
            } else if (senha !== null) {
                showToast('Senha incorreta!', true);
            }
        }

        function logoutAdmin() {
            if (isAdmin) {
                isAdmin = false;
                document.getElementById('adminBtn').innerHTML = 'üîê Admin';
                document.getElementById('adminBtn').style.background = '#6b7280';
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                showToast('Voc√™ saiu do modo administrador');
                updateEventsTable();
            } else {
                checkAdmin();
            }
        }

        // ==================== CONFIGURA√á√ÉO FIREBASE ====================
        const firebaseConfig = {
            apiKey: "AIzaSyD_FbMpEZYn_lLZiSjGmP0sMM7XcuTn8Qw",
            authDomain: "games-idac.firebaseapp.com",
            databaseURL: "https://games-idac-default-rtdb.firebaseio.com",
            projectId: "games-idac",
            storageBucket: "games-idac.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const calendarioRef = database.ref('calendario_2026');

        // ==================== VARI√ÅVEIS GLOBAIS ====================
        const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

        let events = {};
        let currentDate = null;
        let editingEvent = null;
        let editingDate = null;
        
        // Filtros selecionados
        let selectedMonths = [];
        let selectedTypes = [];
        let selectedResps = [];

        // ==================== FIREBASE LISTENERS ====================
        function setupFirebaseListeners() {
            calendarioRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    events = data;
                } else {
                    // Se n√£o houver dados, inicializar com eventos padr√£o
                    initializeDefaultEvents();
                }
                createCalendar();
                buildFilterOptions();
                updateEventsTable();
                updateSyncStatus(true);
            }, (error) => {
                console.error('Erro Firebase:', error);
                updateSyncStatus(false);
                // Fallback para localStorage
                loadFromLocalStorage();
            });
        }

        function updateSyncStatus(online) {
            const status = document.getElementById('syncStatus');
            if (online) {
                status.className = 'sync-status online';
                status.innerHTML = '‚òÅÔ∏è Sincronizado com a nuvem';
            } else {
                status.className = 'sync-status offline';
                status.innerHTML = '‚ö†Ô∏è Modo offline - dados locais';
            }
        }

        function saveToFirebase() {
            calendarioRef.set(events)
                .then(() => {
                    console.log('Dados salvos no Firebase');
                })
                .catch((error) => {
                    console.error('Erro ao salvar:', error);
                    // Fallback para localStorage
                    localStorage.setItem('idac_calendar_2026_firebase', JSON.stringify(events));
                });
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('idac_calendar_2026_firebase');
            if (saved) {
                events = JSON.parse(saved);
            } else {
                initializeDefaultEvents();
            }
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
        }

        // ==================== INICIALIZA√á√ÉO DE EVENTOS PADR√ÉO ====================
        function initializeDefaultEvents() {
            events = {
                '2026-01-24': [{id: generateId(), title: 'Reuni√£o Lideran√ßa', time: '8h √†s 18h', resp: '', type: 'lideranca', notes: ''}],
            };

            // Culto Mulheres (3¬™ quinta-feira) - exceto dezembro
            const cultoMulheres = [
                '2026-02-19', '2026-03-19', '2026-04-16', '2026-05-21', '2026-06-18',
                '2026-07-16', '2026-08-20', '2026-09-17', '2026-10-15', '2026-11-19'
            ];
            cultoMulheres.forEach(date => {
                if (!events[date]) events[date] = [];
                events[date].push({id: generateId(), title: 'Culto Mulheres', time: '20h', resp: 'Min. Mulher', type: 'mulheres', notes: 'Nos lares/Templo'});
            });

            // Eventos especiais
            addDefaultEvent('2026-05-10', 'Caf√© Dia das M√£es', '', 'Minist√©rio a definir', 'especial', '');
            addDefaultEvent('2026-06-26', 'A√ß√£o Estacionamento', '', 'Min. Homens', 'homens', '');
            addDefaultEvent('2026-06-26', 'Bazar', '', 'Min. Mulheres', 'mulheres', '');
            addDefaultEvent('2026-06-27', 'A√ß√£o Estacionamento', '', 'Min. Homens', 'homens', '');
            addDefaultEvent('2026-06-27', 'Bazar', '', 'Min. Mulheres', 'mulheres', '');
            addDefaultEvent('2026-07-10', 'EBF (proposta)', 'Manh√£/Tarde', 'Min. KIDS', 'ebf', 'Dia 1');
            addDefaultEvent('2026-07-11', 'EBF (proposta)', 'Manh√£/Tarde', 'Min. KIDS', 'ebf', 'Dia 2');
            addDefaultEvent('2026-07-12', 'EBF (proposta)', 'Manh√£/Tarde', 'Min. KIDS', 'ebf', 'Dia 3');
            addDefaultEvent('2026-08-09', 'Caf√© Dia dos Pais', '', 'Minist√©rio a definir', 'especial', '');
            addDefaultEvent('2026-08-28', 'Anivers√°rio 11 anos IDAC', '20h', 'Toda Igreja', 'especial', 'Com Batismo nas √°guas - Sexta-feira');
            addDefaultEvent('2026-08-29', 'Anivers√°rio 11 anos IDAC', 'Manh√£/Tarde/Noite', 'Toda Igreja', 'especial', 'Com Batismo nas √°guas - S√°bado');
            addDefaultEvent('2026-08-30', 'Anivers√°rio 11 anos IDAC', '9h30 e 18h', 'Toda Igreja', 'especial', 'Com Batismo nas √°guas - Domingo');
            addDefaultEvent('2026-10-17', 'Dia das Crian√ßas (proposta)', 'Manh√£/Tarde', 'Min. KIDS', 'especial', '');
            addDefaultEvent('2026-11-06', 'Vig√≠lia no Templo', '22h √†s 0h', 'Min. Mulheres', 'mulheres', '');
            addDefaultEvent('2026-11-29', 'Confraterniza√ß√£o Min. Mulheres', '', 'Min. Mulheres', 'mulheres', '');
            addDefaultEvent('2026-12-20', 'Cantata de Natal (proposta)', '', 'Louvor e Artes', 'especial', '');
            addDefaultEvent('2026-12-31', 'Culto e Jantar da Virada (proposta)', '', '', 'especial', '');

            // Feriados Nacionais
            addDefaultEvent('2026-01-01', 'Confraterniza√ß√£o Universal (Ano Novo)', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-04-03', 'Paix√£o de Cristo (Sexta-feira Santa)', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-04-21', 'Tiradentes', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-05-01', 'Dia do Trabalho', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-09-07', 'Independ√™ncia do Brasil', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-10-12', 'Nossa Senhora Aparecida', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-11-02', 'Finados', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-11-15', 'Proclama√ß√£o da Rep√∫blica', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-11-20', 'Dia da Consci√™ncia Negra', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-12-25', 'Natal', '', '', 'feriado', 'Feriado Nacional');
            addDefaultEvent('2026-02-16', 'Carnaval', '', '', 'feriado', 'Ponto Facultativo');
            addDefaultEvent('2026-02-17', 'Carnaval', '', '', 'feriado', 'Ponto Facultativo');
            addDefaultEvent('2026-02-18', 'Quarta-feira de Cinzas', 'at√© 14h', '', 'feriado', 'Ponto Facultativo');
            addDefaultEvent('2026-06-04', 'Corpus Christi', '', '', 'feriado', 'Ponto Facultativo');

            // Copa do Mundo
            addDefaultEvent('2026-06-11', 'COPA: Abertura - M√©xico x √Åfrica do Sul', '16h', '', 'copa', 'Est√°dio Azteca, Cidade do M√©xico');
            addDefaultEvent('2026-06-13', 'COPA: Brasil x Marrocos', '19h', '', 'copa', 'MetLife Stadium, Nova Jersey - 1¬™ rodada');
            addDefaultEvent('2026-06-19', 'COPA: Brasil x Haiti', '22h', '', 'copa', 'Lincoln Financial Field, Filad√©lfia - 2¬™ rodada');
            addDefaultEvent('2026-06-24', 'COPA: Esc√≥cia x Brasil', '19h', '', 'copa', 'Hard Rock Stadium, Miami - 3¬™ rodada');
            addDefaultEvent('2026-06-29', 'COPA: Poss√≠vel jogo Brasil (32-avos)', 'A definir', '', 'copa', 'Houston ou Monterrey (se classificado)');
            addDefaultEvent('2026-07-18', 'COPA: Disputa 3¬∫ lugar', '16h', '', 'copa', 'Hard Rock Stadium, Miami');
            addDefaultEvent('2026-07-19', 'COPA: FINAL', '16h', '', 'copa', 'MetLife Stadium, Nova Jersey');

            // Elei√ß√µes
            addDefaultEvent('2026-10-04', 'ELEI√á√ïES - 1¬∫ Turno', '8h √†s 17h', '', 'eleicao', 'Presidente, Governadores, Senadores, Deputados');
            addDefaultEvent('2026-11-01', 'ELEI√á√ïES - 2¬∫ Turno (se houver)', '8h √†s 17h', '', 'eleicao', 'Presidente e Governadores');

            // Semana de Ora√ß√£o - exceto dezembro
            const ultimasQuartas = [
                '2026-03-25', '2026-04-29', '2026-05-27', '2026-06-24', '2026-07-29',
                '2026-08-26', '2026-09-30', '2026-10-28', '2026-11-25'
            ];
            const ultimasQuintas = [
                '2026-03-26', '2026-04-30', '2026-05-28', '2026-06-25', '2026-07-30',
                '2026-08-27', '2026-09-24', '2026-10-29', '2026-11-26'
            ];

            // Curso "De dentro para fora"
            const cursoQuartas = [
                '2026-01-28', '2026-02-04', '2026-02-11', '2026-02-18',
                '2026-02-25', '2026-03-04', '2026-03-11', '2026-03-18'
            ];
            
            // "Noite" com Deus - todas as quartas
            let date = new Date(2026, 0, 28);
            while (date.getFullYear() === 2026) {
                if (date.getDay() === 3) {
                    const key = formatDateKey(date);
                    if (!events[key]) events[key] = [];
                    if (ultimasQuartas.includes(key)) {
                        events[key].push({id: generateId(), title: 'Semana de Ora√ß√£o', time: '20h', resp: 'Min. Intercess√£o', type: 'especial', notes: ''});
                    } else if (!cursoQuartas.includes(key)) {
                        events[key].push({id: generateId(), title: '"Noite" com Deus', time: '20h', resp: 'Pr¬™ Maria Pereira', type: 'tarde-deus', notes: ''});
                    }
                }
                date.setDate(date.getDate() + 1);
            }

            // Curso
            cursoQuartas.forEach((dateStr, index) => {
                if (!events[dateStr]) events[dateStr] = [];
                events[dateStr].push({id: generateId(), title: 'Curso "De dentro para fora"', time: '20h', resp: 'Pr¬™ Maria/Pr¬™ Nelcy', type: 'curso', notes: `Encontro ${index + 1}/8`});
            });

            // Semana de Ora√ß√£o quintas
            ultimasQuintas.forEach(dateStr => {
                if (!events[dateStr]) events[dateStr] = [];
                events[dateStr].push({id: generateId(), title: 'Semana de Ora√ß√£o', time: '20h', resp: 'Min. Intercess√£o', type: 'especial', notes: ''});
            });

            // Culto Candeias
            const cultoCandeias = [
                '2026-02-05', '2026-03-05', '2026-04-02', '2026-05-07', '2026-06-04',
                '2026-07-02', '2026-08-06', '2026-09-03', '2026-10-01', '2026-11-05', '2026-12-03'
            ];
            cultoCandeias.forEach(dateStr => {
                if (!events[dateStr]) events[dateStr] = [];
                events[dateStr].push({id: generateId(), title: 'Culto Candeias', time: '20h', resp: 'Pb. Jos√© Dias e Di√°c. Lidiane', type: 'candeias', notes: 'Nos lares'});
            });

            saveToFirebase();
        }

        function addDefaultEvent(date, title, time, resp, type, notes) {
            if (!events[date]) events[date] = [];
            events[date].push({id: generateId(), title, time, resp, type, notes});
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDateBR(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        // ==================== CALEND√ÅRIO ====================
        function createCalendar() {
            const container = document.getElementById('calendar');
            container.innerHTML = '';
            
            for (let month = 0; month < 12; month++) {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                
                const monthHeader = document.createElement('div');
                monthHeader.className = 'month-header';
                monthHeader.textContent = monthNames[month];
                monthCard.appendChild(monthHeader);
                
                const weekdaysDiv = document.createElement('div');
                weekdaysDiv.className = 'weekdays';
                weekDays.forEach(day => {
                    const span = document.createElement('span');
                    span.textContent = day;
                    weekdaysDiv.appendChild(span);
                });
                monthCard.appendChild(weekdaysDiv);
                
                const daysDiv = document.createElement('div');
                daysDiv.className = 'days';
                
                const firstDay = new Date(2026, month, 1);
                const lastDay = new Date(2026, month + 1, 0);
                const startDay = firstDay.getDay();
                
                for (let i = 0; i < startDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'day empty';
                    daysDiv.appendChild(emptyDay);
                }
                
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const dayDiv = document.createElement('div');
                    const currentDate = new Date(2026, month, day);
                    const dateKey = formatDateKey(currentDate);
                    const dayEvents = events[dateKey] || [];
                    
                    dayDiv.className = 'day';
                    if (currentDate.getDay() === 0) dayDiv.classList.add('sunday');
                    if (dayEvents.length > 0) dayDiv.classList.add('has-event');
                    
                    dayDiv.onclick = () => openDayModal(dateKey);
                    
                    const dayNumber = document.createElement('span');
                    dayNumber.className = 'day-number';
                    dayNumber.textContent = day;
                    dayDiv.appendChild(dayNumber);
                    
                    if (dayEvents.length > 0) {
                        const dotsDiv = document.createElement('div');
                        dotsDiv.className = 'event-dots';
                        
                        const uniqueTypes = [...new Set(dayEvents.map(e => e.type))];
                        uniqueTypes.slice(0, 4).forEach(type => {
                            const dot = document.createElement('span');
                            dot.className = `event-dot ${type}`;
                            dotsDiv.appendChild(dot);
                        });
                        dayDiv.appendChild(dotsDiv);
                    }
                    
                    daysDiv.appendChild(dayDiv);
                }
                
                monthCard.appendChild(daysDiv);
                container.appendChild(monthCard);
            }
        }

        // ==================== FILTROS COM CHECKBOXES ====================
        function buildFilterOptions() {
            const allEvents = [];
            Object.keys(events).forEach(dateKey => {
                events[dateKey].forEach(event => {
                    allEvents.push({...event, date: dateKey});
                });
            });

            // Meses
            const months = [...new Set(allEvents.map(e => e.date.substring(0, 7)))].sort();
            const monthsContainer = document.getElementById('filterMonths');
            monthsContainer.innerHTML = months.map(m => {
                const [year, month] = m.split('-');
                const monthName = monthNames[parseInt(month) - 1];
                const checked = selectedMonths.includes(m) ? 'checked' : '';
                const checkedClass = selectedMonths.includes(m) ? 'checked' : '';
                return `<label class="filter-checkbox ${checkedClass}">
                    <input type="checkbox" value="${m}" ${checked} onchange="toggleFilter('month', '${m}', this)">
                    ${monthName}
                </label>`;
            }).join('');

            // Tipos
            const typeNames = {
                'lideranca': 'Reuni√£o Lideran√ßa',
                'tarde-deus': '"Noite" com Deus',
                'curso': 'Curso',
                'candeias': 'Culto Candeias',
                'mulheres': 'Min. Mulheres',
                'homens': 'Min. Homens',
                'ebf': 'EBF',
                'especial': 'Eventos Especiais',
                'feriado': 'Feriado',
                'copa': 'Copa do Mundo',
                'eleicao': 'Elei√ß√µes',
                'outro': 'Outros'
            };
            const types = [...new Set(allEvents.map(e => e.type))].sort();
            const typesContainer = document.getElementById('filterTypes');
            typesContainer.innerHTML = types.map(t => {
                const checked = selectedTypes.includes(t) ? 'checked' : '';
                const checkedClass = selectedTypes.includes(t) ? 'checked' : '';
                return `<label class="filter-checkbox ${checkedClass}">
                    <input type="checkbox" value="${t}" ${checked} onchange="toggleFilter('type', '${t}', this)">
                    ${typeNames[t] || t}
                </label>`;
            }).join('');

            // Respons√°veis
            const resps = [...new Set(allEvents.map(e => e.resp).filter(r => r && r.trim()))].sort();
            const respsContainer = document.getElementById('filterResps');
            respsContainer.innerHTML = resps.map(r => {
                const checked = selectedResps.includes(r) ? 'checked' : '';
                const checkedClass = selectedResps.includes(r) ? 'checked' : '';
                return `<label class="filter-checkbox ${checkedClass}">
                    <input type="checkbox" value="${r}" ${checked} onchange="toggleFilter('resp', '${r}', this)">
                    ${r}
                </label>`;
            }).join('');
        }

        function toggleFilter(type, value, checkbox) {
            const label = checkbox.parentElement;
            if (checkbox.checked) {
                label.classList.add('checked');
                if (type === 'month' && !selectedMonths.includes(value)) selectedMonths.push(value);
                if (type === 'type' && !selectedTypes.includes(value)) selectedTypes.push(value);
                if (type === 'resp' && !selectedResps.includes(value)) selectedResps.push(value);
            } else {
                label.classList.remove('checked');
                if (type === 'month') selectedMonths = selectedMonths.filter(m => m !== value);
                if (type === 'type') selectedTypes = selectedTypes.filter(t => t !== value);
                if (type === 'resp') selectedResps = selectedResps.filter(r => r !== value);
            }
            updateEventsTable();
        }

        function clearFilters() {
            selectedMonths = [];
            selectedTypes = [];
            selectedResps = [];
            buildFilterOptions();
            updateEventsTable();
        }

        // ==================== TABELA DE EVENTOS ====================
        function updateEventsTable() {
            const container = document.getElementById('eventsTableContainer');
            
            let allEvents = [];
            Object.keys(events).sort().forEach(dateKey => {
                events[dateKey].forEach(event => {
                    allEvents.push({...event, date: dateKey});
                });
            });
            
            // Aplicar filtros
            if (selectedMonths.length > 0) {
                allEvents = allEvents.filter(e => selectedMonths.includes(e.date.substring(0, 7)));
            }
            if (selectedTypes.length > 0) {
                allEvents = allEvents.filter(e => selectedTypes.includes(e.type));
            }
            if (selectedResps.length > 0) {
                allEvents = allEvents.filter(e => selectedResps.includes(e.resp));
            }
            
            if (allEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0a0a0;">Nenhum evento encontrado</p>';
                return;
            }
            
            container.innerHTML = `
                <p style="text-align: right; font-size: 0.8rem; color: #a0a0a0; margin-bottom: 10px;">üìä ${allEvents.length} evento(s) encontrado(s)</p>
                <table class="events-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Evento</th>
                            <th>Hor√°rio</th>
                            <th>Respons√°vel</th>
                            ${isAdmin ? '<th>A√ß√µes</th>' : ''}
                        </tr>
                    </thead>
                    <tbody>
                        ${allEvents.map(event => `
                            <tr>
                                <td>${formatDateBR(event.date)}</td>
                                <td>${event.title}</td>
                                <td>${event.time || '-'}</td>
                                <td>${event.resp || '-'}</td>
                                ${isAdmin ? `
                                <td class="actions">
                                    <button class="btn-edit-small" onclick="openEditModal('${event.date}', '${event.id}')">‚úèÔ∏è</button>
                                    <button class="btn-delete-small" onclick="deleteEventFromTable('${event.date}', '${event.id}')">üóëÔ∏è</button>
                                </td>
                                ` : ''}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ==================== MODAIS ====================
        function openDayModal(dateKey) {
            currentDate = dateKey;
            const dayEvents = events[dateKey] || [];
            
            document.getElementById('modalTitle').textContent = `üìÖ ${formatDateBR(dateKey)}`;
            
            const eventsContainer = document.getElementById('eventsInDay');
            if (dayEvents.length > 0) {
                eventsContainer.innerHTML = dayEvents.map(event => `
                    <div class="event-card">
                        <div class="event-card-header">
                            <span class="event-card-title">${event.title}</span>
                            ${isAdmin ? `
                            <div class="event-card-actions">
                                <button class="btn-edit-small" onclick="openEditModal('${dateKey}', '${event.id}')">‚úèÔ∏è Editar</button>
                                <button class="btn-delete-small" onclick="deleteEvent('${dateKey}', '${event.id}')">üóëÔ∏è</button>
                            </div>
                            ` : ''}
                        </div>
                        <div class="event-card-details">
                            ${event.time ? `‚è∞ ${event.time}` : ''}
                            ${event.resp ? `<br>üë§ ${event.resp}` : ''}
                            ${event.notes ? `<br>üìù ${event.notes}` : ''}
                        </div>
                    </div>
                `).join('');
            } else {
                eventsContainer.innerHTML = '<p style="color: #a0a0a0; text-align: center;">Nenhum evento neste dia</p>';
            }
            
            // Mostrar/esconder formul√°rio de adicionar baseado em isAdmin
            const addFormSection = document.querySelector('#dayModal hr');
            const addFormTitle = document.querySelector('#dayModal h4');
            const formGroups = document.querySelectorAll('#dayModal .form-group');
            const modalButtons = document.querySelector('#dayModal .modal-buttons');
            
            if (addFormSection) addFormSection.style.display = isAdmin ? '' : 'none';
            if (addFormTitle) addFormTitle.style.display = isAdmin ? '' : 'none';
            formGroups.forEach(fg => fg.style.display = isAdmin ? '' : 'none');
            if (modalButtons) {
                const saveBtn = modalButtons.querySelector('.btn-save');
                if (saveBtn) saveBtn.style.display = isAdmin ? '' : 'none';
            }
            
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventResp').value = '';
            document.getElementById('eventType').value = 'especial';
            document.getElementById('eventNotes').value = '';
            
            document.getElementById('dayModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('dayModal').classList.remove('active');
            currentDate = null;
        }

        function saveEvent() {
            if (!isAdmin) {
                showToast('Apenas administradores podem adicionar eventos', true);
                return;
            }
            const title = document.getElementById('eventTitle').value.trim();
            if (!title) {
                showToast('Digite o t√≠tulo do evento', true);
                return;
            }
            
            const newEvent = {
                id: generateId(),
                title: title,
                time: document.getElementById('eventTime').value.trim(),
                resp: document.getElementById('eventResp').value.trim(),
                type: document.getElementById('eventType').value,
                notes: document.getElementById('eventNotes').value.trim()
            };
            
            if (!events[currentDate]) events[currentDate] = [];
            events[currentDate].push(newEvent);
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            openDayModal(currentDate);
            showToast('Evento adicionado com sucesso!');
        }

        function deleteEvent(dateKey, eventId) {
            if (!isAdmin) {
                showToast('Apenas administradores podem excluir eventos', true);
                return;
            }
            if (!confirm('Deseja realmente excluir este evento?')) return;
            
            events[dateKey] = events[dateKey].filter(e => e.id !== eventId);
            if (events[dateKey].length === 0) delete events[dateKey];
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            openDayModal(dateKey);
            showToast('Evento exclu√≠do!');
        }

        function openAddModal() {
            if (!isAdmin) {
                showToast('Apenas administradores podem adicionar eventos', true);
                return;
            }
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventTitle').value = '';
            document.getElementById('newEventTime').value = '';
            document.getElementById('newEventResp').value = '';
            document.getElementById('newEventType').value = 'especial';
            document.getElementById('newEventNotes').value = '';
            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        function saveNewEvent() {
            if (!isAdmin) {
                showToast('Apenas administradores podem adicionar eventos', true);
                return;
            }
            const dateKey = document.getElementById('newEventDate').value;
            const title = document.getElementById('newEventTitle').value.trim();
            
            if (!dateKey) {
                showToast('Selecione uma data', true);
                return;
            }
            if (!title) {
                showToast('Digite o t√≠tulo do evento', true);
                return;
            }
            
            const newEvent = {
                id: generateId(),
                title: title,
                time: document.getElementById('newEventTime').value.trim(),
                resp: document.getElementById('newEventResp').value.trim(),
                type: document.getElementById('newEventType').value,
                notes: document.getElementById('newEventNotes').value.trim()
            };
            
            if (!events[dateKey]) events[dateKey] = [];
            events[dateKey].push(newEvent);
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            closeAddModal();
            showToast('Evento adicionado com sucesso!');
        }

        function openEditModal(dateKey, eventId) {
            if (!isAdmin) {
                showToast('Apenas administradores podem editar eventos', true);
                return;
            }
            editingDate = dateKey;
            const event = events[dateKey].find(e => e.id === eventId);
            editingEvent = event;
            
            document.getElementById('editEventDate').value = dateKey;
            document.getElementById('editEventTitle').value = event.title;
            document.getElementById('editEventTime').value = event.time || '';
            document.getElementById('editEventResp').value = event.resp || '';
            document.getElementById('editEventType').value = event.type || 'especial';
            document.getElementById('editEventNotes').value = event.notes || '';
            
            document.getElementById('dayModal').classList.remove('active');
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingEvent = null;
            editingDate = null;
        }

        function updateEvent() {
            if (!isAdmin) {
                showToast('Apenas administradores podem editar eventos', true);
                return;
            }
            const newDateKey = document.getElementById('editEventDate').value;
            const title = document.getElementById('editEventTitle').value.trim();
            
            if (!title) {
                showToast('Digite o t√≠tulo do evento', true);
                return;
            }
            
            events[editingDate] = events[editingDate].filter(e => e.id !== editingEvent.id);
            if (events[editingDate].length === 0) delete events[editingDate];
            
            const updatedEvent = {
                id: editingEvent.id,
                title: title,
                time: document.getElementById('editEventTime').value.trim(),
                resp: document.getElementById('editEventResp').value.trim(),
                type: document.getElementById('editEventType').value,
                notes: document.getElementById('editEventNotes').value.trim()
            };
            
            if (!events[newDateKey]) events[newDateKey] = [];
            events[newDateKey].push(updatedEvent);
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            closeEditModal();
            showToast('Evento atualizado!');
        }

        function deleteEditingEvent() {
            if (!isAdmin) {
                showToast('Apenas administradores podem excluir eventos', true);
                return;
            }
            if (!confirm('Deseja realmente excluir este evento?')) return;
            
            events[editingDate] = events[editingDate].filter(e => e.id !== editingEvent.id);
            if (events[editingDate].length === 0) delete events[editingDate];
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            closeEditModal();
            showToast('Evento exclu√≠do!');
        }

        function deleteEventFromTable(dateKey, eventId) {
            if (!isAdmin) {
                showToast('Apenas administradores podem excluir eventos', true);
                return;
            }
            if (!confirm('Deseja realmente excluir este evento?')) return;
            
            events[dateKey] = events[dateKey].filter(e => e.id !== eventId);
            if (events[dateKey].length === 0) delete events[dateKey];
            
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            showToast('Evento exclu√≠do!');
        }

        function exportEvents() {
            const dataStr = JSON.stringify(events, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'calendario_idac_2026.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Arquivo exportado com sucesso!');
        }

        function clearAllEvents() {
            if (!isAdmin) {
                showToast('Apenas administradores podem limpar eventos', true);
                return;
            }
            if (!confirm('Deseja realmente APAGAR TODOS os eventos? Esta a√ß√£o n√£o pode ser desfeita.')) return;
            if (!confirm('TEM CERTEZA? Todos os eventos ser√£o perdidos!')) return;
            
            events = {};
            saveToFirebase();
            createCalendar();
            buildFilterOptions();
            updateEventsTable();
            showToast('Todos os eventos foram removidos');
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast active' + (isError ? ' error' : '');
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Fechar modais clicando fora
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Inicializar
        setupFirebaseListeners();
    </script>
</body>
</html>
